sudo: required
group: edge
language: ruby
rvm:
- 2.0.0
services:
- docker

before_install:
- export TZ=America/New_York
- date
- export DISPLAY=:1
- Xvfb :1 -screen 0 1280x960x24 &
- sleep 5
# - sudo apt-get install texlive-full  

script:
- docker build -t wkoszek/docker_edu .
- docker run -d -p 80:80 wkoszek/docker_edu
- sleep 15
- netstat -tunpl
- firefox -url www.google.com &
- sleep 8
- import -window root -crop 1264x948+0+0 -resize 800x600 -quality 95 screenshot.png
- ls -la
- curl https://raw.githubusercontent.com/tjordanchat/edu_docker/master/build.sh |
  bash
- find / -name mozilla.cfg 2>/dev/null
  
after_success:
- docker ps -a

deploy:
  provider: releases
  file: screenshot.png
  api_key: ${GH_TOKEN}
  skip_cleanup: true
  on:
    tags: true

after_deploy:
- git clone https://${GH_TOKEN}@github.com/tjordanchat/edu_docker.git
- cd edu_docker
- git config --global user.email "travis@travis-ci.org"
- git config --global user.name "tjordanchat"
- git checkout gh_pages 2>&1 || git checkout --orphan gh_pages 2>&1
- curl https://api.github.com/repos/tjordanchat/edu_docker/releases/latest | jq -r ".assets[] | select(.name | test(\"${spruce_type}\")) | .browser_download_url" > .url
- git add -f .url
- git commit -am "$TRAVIS_COMMIT"
- git push https://${GH_TOKEN}@github.com/tjordanchat/edu_docker.git gh_pages 2>&1
 
env:
  global:
    secure: fK6Ggem/+doXjH0xVC2vooxZUVVd1rE/EaZLRVgtFegWA+4P4NvDtwtj55gtFx3/meOVWh4pmUuwufZJsSWeCF3u9qAHk2OiZHBWHl2ukLjTiGJHOIknQ/SyjCtFei4VCig4Ab1sS0GBCAelBCPKbs1rFPtEjWZQihRXzfkDh9u+avqlP8UtuDTDd//NvQdprOfjAUY+onMpSW23JU5uVE5AO8J1PuIXkWX5Ze3zCDuKrT6mMmX4pEqWXzcOEhmcwfSddPglXzTCacuKVAH0G+ezrX4W1gLx14bcQkjdFtwj6hnB5oaWSN5kyl732Nk8G1N6rddYri1ShFh1HFCtsfJzqGXVhRDNo0RFsnMbRUix/vitB61qcq1LLmqe0FjFfIX34RsMjptyeYbhPMNFjm0oWYtaZD6YnQubMSmtvPNtHnnjRdwGR0e2sagB55vu1frKxWPt0rG7N0xp4xQHuSoOeKAExtYarIwfeHqGFz+JavglTjZDtWOSStoXWj1rpyEabCf1FFn1msffPL+IVvRYv/uLGhW4zNFlZz/9qfrKmkArSkYBhjW/TuVtOKm6m/py6ZxRhxGYUBC7EHdI2/hMpkIa+7l8CT5l4uwjKUYXHpYPKiwPBWvmxmmxyjjWcd6tqPUoR++zwC7079ADFB0CeMvTroTw3vF66QQi6Jg=
